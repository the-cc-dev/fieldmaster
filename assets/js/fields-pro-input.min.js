!function($){fields.pro=fields.model.extend({actions:{refresh:"refresh"},filters:{get_fields:"get_fields"},get_fields:function(e){return e=e.not(".fields-clone .fields-field")},refresh:function(){var e=this;$(".fields-table").each(function(){var t=$(this),a=t.find("> thead th.fields-th");a.exists()&&(a.each(function(){var e=$(this),a=t.find('> tbody > tr > td[data-key="'+e.attr("data-key")+'"]');a.removeClass("appear-empty"),e.removeClass("hidden-by-conditional-logic"),a.length>1&&(a=a.not(":last")),0==a.not(".hidden-by-conditional-logic").length?e.addClass("hidden-by-conditional-logic"):a.addClass("appear-empty")}),e.render_table(t))})},render_table:function(e){var t=e.find("> thead th.fields-th"),a=100;t.exists()&&(t.css("width","auto"),t=t.not(".hidden-by-conditional-logic"),t.filter("[data-width]").each(function(){var e=parseInt($(this).attr("data-width"));a-=e,$(this).css("width",e+"%")}),t=t.not("[data-width]"),t.each(function(){var e=a/t.length;$(this).css("width",e+"%")}))}})}(jQuery),function($){fields.fields.repeater=fields.field.extend({type:"repeater",$el:null,$input:null,$tbody:null,$clone:null,actions:{ready:"initialize",append:"initialize",show:"show"},events:{"click .fields-repeater-add-row":"add","click .fields-repeater-remove-row":"remove"},focus:function(){this.$el=this.$field.find(".fields-repeater:first"),this.$input=this.$field.find("input:first"),this.$tbody=this.$el.find("tbody:first"),this.$clone=this.$tbody.children("tr.fields-clone"),this.o=fields.get_data(this.$el)},initialize:function(){if(this.$tbody.on("mouseenter","tr.fields-row",function(e){var t=$(this),a=t.children(".remove"),i=a.find(".fields-repeater-add-row"),l=a.height()/2+9;i.css("margin-top","-"+l+"px")}),1!=this.o.max){var e=this,t=this.$tbody,a=this.$field;t.one("mouseenter","td.order",function(i){t.unbind("sortable").sortable({items:"> tr",handle:"> td.order",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(t,i){e.doFocus(a),fields.do_action("sortstart",i.item,i.placeholder)},stop:function(t,a){e.render(),fields.do_action("sortstop",a.item,a.placeholder)},update:function(t,a){e.$input.trigger("change")}})})}this.$clone.find("input, textarea, select").attr("disabled","disabled"),this.render()},show:function(){this.$tbody.find(".fields-field:visible").each(function(){fields.do_action("show_field",$(this))})},count:function(){return this.$tbody.children().length-1},render:function(){this.$tbody.children().each(function(e){$(this).children("td.order").html(e+1)}),0==this.count()?this.$el.addClass("-empty"):this.$el.removeClass("-empty"),this.o.max>0&&this.count()>=this.o.max?this.$el.find("> .fields-hl .fields-button").addClass("disabled"):this.$el.find("> .fields-hl .fields-button").removeClass("disabled")},add:function(e){var t=this.$clone;if(e&&e.$el.is(".fields-icon")&&(t=e.$el.closest(".fields-row")),this.o.max>0&&this.count()>=this.o.max)return alert(fields._e("repeater","max").replace("{max}",this.o.max)),!1;var a=fields.get_uniqid(),i=this.$clone.outerHTML(),i=i.replace(/(="[\w-\[\]]+?)(fieldscloneindex)/g,"$1"+a),l=$(i);return l.removeClass("fields-clone"),l.find("input, textarea, select").not(".fields-disabled").removeAttr("disabled"),t.before(l),this.$field.parents(".fields-row").trigger("mouseenter"),this.render(),fields.validation.remove_error(this.$field),fields.do_action("append",l),l},remove:function(e){var t=this,a=this.$field,i=e.$el.closest(".fields-row"),l=i.closest("table");return this.count()<=this.o.min?(alert(fields._e("repeater","min").replace("{min}",this.o.min)),!1):(fields.do_action("remove",i),void fields.remove_tr(i,function(){t.$input.trigger("change"),t.doFocus(a).render(),a.closest(".fields-row").trigger("mouseenter"),l.hasClass("table-layout")&&fields.conditional_logic.render(l)}))}})}(jQuery),function($){fields.fields.flexible_content=fields.field.extend({type:"flexible_content",$el:null,$input:null,$values:null,$clones:null,actions:{ready:"initialize",append:"initialize",show:"show"},events:{"click .fields-fc-remove":"remove","click .fields-fc-layout-handle":"toggle","click .fields-fc-toggle":"toggle","click .fields-fc-popup li a":"add","click .fields-fc-add":"open_popup","blur .fields-fc-popup .focus":"close_popup"},focus:function(){this.$el=this.$field.find(".fields-flexible-content:first"),this.$input=this.$field.find("input:first"),this.$values=this.$el.children(".values"),this.$clones=this.$el.children(".clones"),this.o=fields.get_data(this.$el),this.o.min=this.o.min||0,this.o.max=this.o.max||0},count:function(){return this.$values.children(".layout").length},initialize:function(){if(1!=this.o.max){var e=this,t=this.$values,a=this.$field;t.one("mouseenter",".fields-fc-layout-handle",function(i){t.unbind("sortable").sortable({items:"> .layout",handle:"> .fields-fc-layout-handle",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(t,i){e.doFocus(a),fields.do_action("sortstart",i.item,i.placeholder)},stop:function(t,a){e.render(),fields.do_action("sortstop",a.item,a.placeholder)},update:function(t,a){e.$input.trigger("change")}})})}this.$clones.find("input, textarea, select").attr("disabled","disabled"),this.render()},show:function(){this.$values.find(".fields-field:visible").each(function(){fields.do_action("show_field",$(this))})},render:function(){this.$values.children(".layout").each(function(e){$(this).find("> .fields-fc-layout-handle .fc-layout-order").html(e+1)}),0==this.count()?this.$el.addClass("empty"):this.$el.removeClass("empty"),this.o.max>0&&this.count()>=this.o.max?(this.$el.addClass("disabled"),this.$el.find("> .fields-hl .fields-button").addClass("disabled")):(this.$el.removeClass("disabled"),this.$el.find("> .fields-hl .fields-button").removeClass("disabled"))},validate_add:function(e){if(this.o.max>0&&this.count()>=this.o.max){var t=1==this.o.max?"layout":"layouts",a=fields._e("flexible_content","max");return a=a.replace("{max}",this.o.max),a=a.replace("{identifier}",fields._e("flexible_content",t)),alert(a),!1}var i=$(this.$el.children(".tmpl-popup").html()),l=i.find('[data-layout="'+e+'"]'),n=parseInt(l.attr("data-max")),s=this.$values.children('.layout[data-layout="'+e+'"]').length;if(n>0&&s>=n){var t=1==n?"layout":"layouts",a=fields._e("flexible_content","max_layout");return a=a.replace("{max}",s),a=a.replace("{label}",'"'+l.text()+'"'),a=a.replace("{identifier}",fields._e("flexible_content",t)),alert(a),!1}return!0},validate_remove:function(e){if(this.o.min>0&&this.count()<=this.o.min){var t=1==this.o.min?"layout":"layouts",a=fields._e("flexible_content","min")+", "+fields._e("flexible_content","remove");return a=a.replace("{min}",this.o.min),a=a.replace("{identifier}",fields._e("flexible_content",t)),a=a.replace("{layout}",fields._e("flexible_content","layout")),confirm(a)}var i=$(this.$el.children(".tmpl-popup").html()),l=i.find('[data-layout="'+e+'"]'),n=parseInt(l.attr("data-min")),s=this.$values.children('.layout[data-layout="'+e+'"]').length;if(n>0&&n>=s){var t=1==n?"layout":"layouts",a=fields._e("flexible_content","min_layout")+", "+fields._e("flexible_content","remove");return a=a.replace("{min}",s),a=a.replace("{label}",'"'+l.text()+'"'),a=a.replace("{identifier}",fields._e("flexible_content",t)),a=a.replace("{layout}",fields._e("flexible_content","layout")),confirm(a)}return!0},open_popup:function(e){var t=this.$values,a=$(this.$el.children(".tmpl-popup").html());a.find("a").each(function(){var e=parseInt($(this).attr("data-min")),a=parseInt($(this).attr("data-max")),i=$(this).attr("data-layout"),l=$(this).text(),n=t.children('.layout[data-layout="'+i+'"]').length,s=$(this).children(".status");if(a>0){var c=a-n,o=fields._e("flexible_content","available"),r=1==c?"layout":"layouts",o=o.replace("{available}",c);o=o.replace("{max}",a),o=o.replace("{label}",'"'+l+'"'),o=o.replace("{identifier}",fields._e("flexible_content",r)),s.show().text(c).attr("title",o),0==c&&s.addClass("warning")}if(e>0){var d=e-n,o=fields._e("flexible_content","required"),r=1==d?"layout":"layouts",o=o.replace("{required}",d);o=o.replace("{min}",e),o=o.replace("{label}",'"'+l+'"'),o=o.replace("{identifier}",fields._e("flexible_content",r)),d>0&&s.addClass("warning").show().text(d).attr("title",o)}}),e.$el.after(a),e.$el.attr("data-before")&&(a.addClass("within-layout"),a.closest(".layout").addClass("popup-open")),a.css({"margin-top":0-a.height()-e.$el.outerHeight()-14,"margin-left":(e.$el.outerWidth()-a.width())/2});var i=a.offset().top;30>i&&(a.css({"margin-top":15}),a.find(".bit").addClass("top")),a.children(".focus").trigger("focus")},close_popup:function(e){var t=e.$el.parent();t.closest(".layout").exists()&&t.closest(".layout").removeClass("popup-open"),setTimeout(function(){t.remove()},200)},add:function(e){var t=e.$el.closest(".fields-fc-popup"),a=e.$el.attr("data-layout");if(this.validate_add(a)){var i=fields.get_uniqid(),l=this.$clones.children('.layout[data-layout="'+a+'"]').outerHTML(),l=l.replace(/(="[\w-\[\]]+?)(fieldscloneindex)/g,"$1"+i),n=$(l);n.find("input, textarea, select").not(".fields-disabled").removeAttr("disabled"),this.$el.children(".no-value-message").hide(),n.removeClass("fields-clone"),this.$values.append(n),t.hasClass("within-layout")&&t.closest(".layout").before(n),fields.do_action("append",n),this.render(),fields.validation.remove_error(this.$field)}},remove:function(e){var t=this,a=e.$el.closest(".layout");if(this.validate_remove(a.attr("data-layout"))){var i=0,l=this.$el.children(".no-value-message");0==a.siblings(".layout").length&&(i=l.outerHeight()),fields.do_action("remove",a),fields.remove_el(a,function(){t.render(),t.$input.trigger("change"),i>0&&l.show()},i)}},toggle:function(e){var t=e.$el.closest(".layout");t.hasClass("closed")?(t.removeClass("closed"),fields.do_action("refresh",t)):t.addClass("closed"),this.sync()},sync:function(){var e="fields_collapsed_"+fields.get_data(this.$field,"key"),t=[];this.$values.children(".layout").each(function(e){$(this).hasClass("closed")&&t.push(e)}),fields.update_cookie(e,t.join("|"))}})}(jQuery),function($){fields.fields.gallery=fields.field.extend({type:"gallery",$el:null,actions:{ready:"initialize",append:"initialize",submit:"close_sidebar",show:"resize"},events:{"click .fields-gallery-attachment":"select_attachment","click .remove-attachment":"remove_attachment","click .edit-attachment":"edit_attachment","click .update-attachment":"update_attachment","click .add-attachment":"add_attachment","click .close-sidebar":"close_sidebar","change .fields-gallery-side input":"update_attachment","change .fields-gallery-side textarea":"update_attachment","change .fields-gallery-side select":"update_attachment","change .bulk-actions":"sort"},focus:function(){this.$el=this.$field.find(".fields-gallery").first(),this.$values=this.$el.children(".values"),this.$clones=this.$el.children(".clones"),this.o=fields.get_data(this.$el),this.o.min=this.o.min||0,this.o.max=this.o.max||0},get_attachment:function(e){e=e||"";var t=".fields-gallery-attachment";return"active"===e?t+=".active":e&&(t+='[data-id="'+e+'"]'),this.$el.find(t)},count:function(){return this.get_attachment().length},initialize:function(){var e=this,t=this.$field;this.$el.find(".fields-gallery-attachments").unbind("sortable").sortable({items:".fields-gallery-attachment",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(e,t){t.placeholder.html(t.item.html()),t.placeholder.removeAttr("style"),fields.do_action("sortstart",t.item,t.placeholder)},stop:function(e,t){fields.do_action("sortstop",t.item,t.placeholder)}}),this.$el.unbind("resizable").resizable({handles:"s",minHeight:200,stop:function(e,t){fields.update_user_setting("gallery_height",t.size.height)}}),$(window).on("resize",function(){e.doFocus(t).resize()}),this.render(),this.resize()},render:function(){var e=this.$el.find(".bulk-actions"),t=this.$el.find(".add-attachment");this.o.max>0&&this.count()>=this.o.max?t.addClass("disabled"):t.removeClass("disabled")},sort:function(e){var t=e.$el.val();if(t){var a=fields.prepare_for_ajax({action:"fields/fields/gallery/get_sort_order",field_key:fields.get_field_key(this.$field),post_id:fields.get("post_id"),ids:[],sort:t});this.get_attachment().each(function(){a.ids.push($(this).attr("data-id"))});var i=$.ajax({url:fields.get("ajaxurl"),dataType:"json",type:"post",cache:!1,data:a,context:this,success:this.sort_success})}},sort_success:function(e){if(fields.is_ajax_success(e)){e.data.reverse();for(i in e.data){var t=e.data[i],a=this.get_attachment(t);this.$el.find(".fields-gallery-attachments").prepend(a)}}},clear_selection:function(){this.get_attachment().removeClass("active")},select_attachment:function(e){var t=e.$el;if(!t.hasClass("active")){var a=t.attr("data-id");this.clear_selection(),t.addClass("active"),this.fetch(a),this.open_sidebar()}},open_sidebar:function(){this.$el.addClass("sidebar-open"),this.$el.find(".bulk-actions").hide();var e=this.$el.width()/3;e=parseInt(e),e=Math.max(e,350),this.$el.find(".fields-gallery-side-inner").css({width:e-1}),this.$el.find(".fields-gallery-side").animate({width:e-1},250),this.$el.find(".fields-gallery-main").animate({right:e},250)},close_sidebar:function(){this.$el.removeClass("sidebar-open");var e=this.$el.find(".bulk-actions");this.clear_selection(),this.$el.find(".fields-gallery-side").find("input, textarea, select").attr("disabled","disabled"),this.$el.find(".fields-gallery-main").animate({right:0},250),this.$el.find(".fields-gallery-side").animate({width:0},250,function(){e.show(),$(this).find(".fields-gallery-side-data").html("")})},fetch:function(e){var t=fields.prepare_for_ajax({action:"fields/fields/gallery/get_attachment",field_key:fields.get_field_key(this.$field),nonce:fields.get("nonce"),post_id:fields.get("post_id"),id:e});this.$el.data("xhr")&&this.$el.data("xhr").abort();var a=$.ajax({url:fields.get("ajaxurl"),dataType:"html",type:"post",cache:!1,data:t,context:this,success:this.render_fetch});this.$el.data("xhr",a)},render_fetch:function(e){if(e){var t=this.$el.find(".fields-gallery-side-data");t.html(e),t.find(".compat-field-fields-form-data").remove();var a=t.find("> .compat-attachment-fields > tbody > tr").detach();t.find("> table.form-table > tbody").append(a),t.find("> .compat-attachment-fields").remove(),fields.do_action("append",t)}},update_attachment:function(){var e=this.$el.find(".update-attachment");return $form=this.$el.find(".fields-gallery-side-data"),data=fields.serialize_form($form),e.attr("disabled")?!1:(e.attr("disabled","disabled"),e.before('<i class="fields-loading"></i>'),data.action="fields/fields/gallery/update_attachment",fields.prepare_for_ajax(data),void $.ajax({url:fields.get("ajaxurl"),data:data,type:"post",dataType:"json",complete:function(t){e.removeAttr("disabled"),e.prev(".fields-loading").remove()}}))},add:function(e){if(this.o.max>0&&this.count()>=this.o.max)return void fields.validation.add_warning(this.$field,fields._e("gallery","max"));var t=e.url,a="fields-gallery-attachment fields-soh",i="",l=this.$el.find('[data-name="ids"]').attr("name");"image"!==e.type&&e.filename&&(i='<div class="filename">'+e.filename+"</div>"),t||(t=e.icon,a+=" is-mime-icon");var n=['<div class="'+a+'" data-id="'+e.id+'">','<input type="hidden" value="'+e.id+'" name="'+l+'[]">','<div class="margin" title="'+e.filename+'">','<div class="thumbnail">','<img src="'+t+'">',"</div>",i,"</div>",'<div class="actions fields-soh-target">','<a href="#" class="fields-icon fields-icon-cancel dark remove-attachment" data-id="'+e.id+'"></a>',"</div>","</div>"].join("");this.$el.find(".fields-gallery-attachments").append(n),this.render()},edit_attachment:function(e){var t=this,a=fields.get_data(e.$el,"id"),i=fields.media.popup({title:fields._e("image","edit"),button:fields._e("image","update"),mode:"edit",id:a,select:function(e){fields.isset(e,"attributes","sizes",t.o.preview_size,"url")&&(e.url=e.attributes.sizes[t.o.preview_size].url),t.get_attachment(a).find("img").attr("src",e.url),t.fetch(a)}})},remove_attachment:function(e){e.stopPropagation();var t=fields.get_data(e.$el,"id");this.clear_selection(),this.close_sidebar(),this.get_attachment(t).remove(),this.render()},render_collection:function(e){var t=this;setTimeout(function(){var a=e.content.get().$el;if(collection=e.content.get().collection||null,collection){var i=-1;collection.each(function(e){i++;var l=a.find(".attachments > .attachment:eq("+i+")");t.get_attachment(e.id).exists()&&(e.off("selection:single"),l.addClass("fields-selected"))})}},10)},add_attachment:function(e){if(this.o.max>0&&this.count()>=this.o.max)return void fields.validation.add_warning(this.$field,fields._e("gallery","max"));var t=this.o.preview_size,a=this,i=this.$field,l=fields.media.popup({title:fields._e("gallery","select"),mode:"select",type:"",field:fields.get_field_key(this.$field),multiple:"add",library:this.o.library,mime_types:this.o.mime_types,select:function(e,l){var n=e.attributes;if(a.doFocus(i),!a.get_attachment(n.id).exists()){var s={id:n.id,type:n.type,icon:n.icon,filename:n.filename,url:""};"image"===s.type?s.url=fields.maybe_get(n,"sizes."+t+".url",n.url):s.url=fields.maybe_get(n,"thumb.src",""),a.add(s)}}});l.on("content:activate:browse",function(){a.render_collection(l),l.content.get().collection.on("reset add",function(){a.render_collection(l)})})},resize:function(){for(var e=100,t=175,a=4,i=this.$el.width(),l=4;20>l;l++){var n=i/l;if(n>e&&t>n){a=l;break}}a=Math.min(a,8),this.$el.attr("data-columns",a)}})}(jQuery);
