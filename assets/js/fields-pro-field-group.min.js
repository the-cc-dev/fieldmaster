!function($){fields.field_group_pro=fields.model.extend({actions:{open_field:"update_field_parent",sortstop:"update_field_parent",duplicate_field:"duplicate_field",delete_field:"delete_field",change_field_type:"change_field_type"},fix_conditional_logic:function(e){var a={};e.each(function(){a[$(this).attr("data-orig")]=$(this).attr("data-key")}),e.find(".conditional-rule-param").each(function(){var e=$(this).val();e in a&&($(this).find('option[value="'+a[e]+'"]').exists()||$(this).append('<option value="'+a[e]+'">'+a[e]+"</option>"),$(this).val(a[e]))})},update_field_parent:function(e){if(e.hasClass("fields-field-object")){var a=e.parent().closest(".fields-field-object"),t=fields.get("post_id");a.exists()&&(t=fields.field_group.get_field_meta(a,"ID"),t||(t=fields.field_group.get_field_meta(a,"key"))),fields.field_group.update_field_meta(e,"parent",t),fields.do_action("update_field_parent",e,a)}},duplicate_field:function(e){var a=e.find(".fields-field-object").not('[data-id="fieldscloneindex"]');a.exists()&&(a.each(function(){var e=$(this).parent().closest(".fields-field-object"),a=fields.field_group.get_field_meta(e,"key");fields.field_group.wipe_field($(this)),fields.field_group.update_field_meta($(this),"parent",a),fields.field_group.save_field($(this))}),this.fix_conditional_logic(a))},delete_field:function(e){e.find(".fields-field-object").each(function(){fields.field_group.delete_field($(this),!1)})},change_field_type:function(e){e.find(".fields-field-object").each(function(){fields.field_group.delete_field($(this),!1)})}});var e=fields.model.extend({actions:{open_field:"render",change_field_type:"render"},events:{'change .fields-field[data-name="layout"] input':"render"},event:function(e){return e.$el.closest(".fields-field-object")},render:function(e){if("repeater"==e.attr("data-type")){var a=e.find('.fields-field[data-name="layout"] input:checked'),t=e.find(".fields-field-list:first");t.attr("data-layout",a.val()),t.hasClass("ui-sortable")||fields.field_group.sort_fields(t)}}}),a=fields.model.extend({actions:{open_field:"render",change_field_type:"render",update_field_parent:"update_field_parent"},events:{"change .fields-fc-meta-display select":"_layout","blur .fields-fc-meta-label input":"_label",'click a[data-name="fields-fc-add"]':"_add",'click a[data-name="fields-fc-duplicate"]':"_duplicate",'click a[data-name="fields-fc-delete"]':"_delete"},event:function(e){return e.$el.closest('tr[data-name="fc_layout"]')},render:function(e){var a=this;if("flexible_content"==e.attr("data-type")){var t=e.find("> .settings > table > tbody");t.hasClass("ui-sortable")||t.sortable({items:'> tr[data-name="fc_layout"]',handle:'[data-name="fields-fc-reorder"]',forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(e,a){fields.do_action("sortstart",a.item,a.placeholder)},stop:function(a,t){fields.do_action("sortstop",t.item,t.placeholder),fields.field_group.save_field(e)}}),t.children('tr[data-name="fc_layout"]').each(function(){a.render_layout($(this))})}},render_layout:function(e){var a=this,t=e.find(".fields-fc-meta-key:first input"),i=e.find(".fields-fc-meta-display:first select"),f=e.find(".fields-field-list:first");t.val(e.attr("data-id")),f.attr("data-layout",i.val()),f.hasClass("ui-sortable")||fields.field_group.sort_fields(f);var d=e.attr("data-id");f.children(".fields-field-object").each(function(){a.render_meta($(this),d)})},render_meta:function(e,a){fields.field_group.update_field_meta(e,"parent_layout",a)},update_field_parent:function(e,a){if(!a.exists())return void fields.field_group.delete_field_meta(e,"parent_layout");if("flexible_content"!=a.attr("data-type"))return void fields.field_group.delete_field_meta(e,"parent_layout");var t=e.closest('tr[data-name="fc_layout"]');this.render_meta(e,t.attr("data-id")),fields.field_group.save_field(e)},_layout:function(e){this.render_layout(e)},_add:function(e){$el2=fields.duplicate(e),$el2.find(".fields-field-object").not('[data-id="fieldscloneindex"]').remove(),$el2.find(".no-fields-message").show(),$el2.find(".fields-fc-meta input").val(""),e.after($el2),this.render_layout($el2),fields.field_group.save_field(e.closest(".fields-field-object"))},_duplicate:function(e){$el2=fields.duplicate(e);var a=$el2.find(".fields-field-object").not('[data-id="fieldscloneindex"]');a.each(function(){fields.field_group.wipe_field($(this)),fields.field_group.save_field($(this))}),fields.field_group_pro.fix_conditional_logic(a),e.after($el2),this.render_layout($el2),fields.field_group.save_field(e.closest(".fields-field-object"))},_delete:function(e){return 0==e.siblings('tr[data-name="fc_layout"]').length?(alert(fields._e("flexible_content","layout_warning")),!1):(e.find(".fields-field-object").not('[data-id="fieldscloneindex"]').each(function(){fields.field_group.delete_field($(this),!1)}),fields.remove_tr(e),void fields.field_group.save_field(e.closest(".fields-field-object")))},_label:function(e){var a=e.find(".fields-fc-meta-label:first input"),t=e.find(".fields-fc-meta-name:first input");if(""==t.val()){var i=a.val();i=fields.str_sanitize(i),t.val(i).trigger("change")}}})}(jQuery);
